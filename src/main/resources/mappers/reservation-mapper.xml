<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="reservationMapper">

    <!-- ReservationWithVaccineResult 설정 -->
    <resultMap id="ReservationWithVaccineResult" type="com.project.trinity.reservation.model.vo.Reservation">
        <id property="resNo" column="RES_NO"/>
        <result property="userNo" column="USER_NO"/>
        <result property="hosNo" column="HOS_NO"/>
         <result property="patientName" column="PATIENT_NAME"/> <!-- PATIENT_NAME 추가 -->
       	<result property="patientBirthday" column="PATIENT_BIRTHDAY"/>
        <result property="resDate" column="RES_DATE"/>
        <result property="resTime" column="RES_TIME"/>
        <result property="resCategory" column="RES_CATEGORY"/>
        <result property="resContent" column="RES_CONTENT"/>
    </resultMap>

    <insert id="insertReservation" parameterType="com.project.trinity.reservation.model.vo.Reservation" useGeneratedKeys="true" keyProperty="resNo">
    INSERT INTO RESERVATION (
        RES_NO, 
        USER_NO, 
        HOS_NO, 
        RES_DATE, 
        RES_TIME, 
        RES_CATEGORY, 
        RES_CONTENT, 
        PATIENT_NAME, 
        PATIENT_BIRTHDAY
    ) VALUES (
        RESERVATION_SEQ.NEXTVAL,
        #{userNo}, 
        #{hosNo}, 
        SYSDATE,   
        #{resTime}, 
        #{resCategory}, 
        #{resContent}, 
        #{patientName}, 
        #{patientBirthday}
    )
</insert>

    <!-- 예약 정보와 백신 종류 조회 -->
    <select id="selectReservationWithVaccine" resultMap="ReservationWithVaccineResult">
        SELECT 
            r.RES_NO, r.USER_NO, r.HOS_NO, r.RES_DATE, r.RES_TIME, 
            r.RES_CATEGORY, r.RES_CONTENT, r.PATIENT_NAME, t.VACCINE_CATEGORY
        FROM 
            RESERVATION r
        LEFT JOIN 
            TREATMENT t ON r.RES_NO = t.RES_NO
        WHERE 
            r.RES_NO = #{resNo}
    </select>

</mapper>
